<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal ETC Hub</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    
    <style>
        /* [1. ê³µí†µ ë””ìì¸ ì‹œìŠ¤í…œ] */
        :root {
            --bg-body: #f4f7f6;
            --card-main: #ffffff;
            --primary: #2c3e50;
            --accent: #e74c3c;
            --hwatu-red: #cc0000;
        }

        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--bg-body); margin: 0; padding: 50px 20px; color: #333; }
        .header { text-align: center; margin-bottom: 50px; }
        
        /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
        .dashboard { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .app-card { background: var(--card-main); border-radius: 24px; padding: 40px 20px; text-align: center; cursor: pointer; transition: 0.4s; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .app-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: var(--primary); }
        .app-card .icon { font-size: 60px; margin-bottom: 20px; display: block; }
        .app-card h2 { margin: 10px 0; font-size: 1.6rem; }
        .app-card p { color: #666; font-size: 0.95rem; line-height: 1.6; }

        /* [2. ê³µí†µ ëª¨ë‹¬ ì‹œìŠ¤í…œ] */
        #modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: flex-start; padding: 40px 20px; overflow-y: auto; backdrop-filter: blur(8px); }
        .modal-container { background: white; width: 100%; max-width: 1150px; border-radius: 28px; position: relative; animation: popUp 0.3s ease-out; box-shadow: 0 25px 50px rgba(0,0,0,0.4); }
        @keyframes popUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { padding: 20px 30px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 10; border-radius: 28px 28px 0 0; }
        .close-btn { background: #ff4757; color: white; border: none; padding: 10px 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .app-content { padding: 40px; min-height: 500px; }

        /* [3. í”„ë¡œì íŠ¸ë³„ íŠ¹í™” ìŠ¤íƒ€ì¼] */
        /* ë¡œë˜ */
        .ball-container { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
        .ball { width: 44px; height: 44px; line-height: 44px; border-radius: 50%; color: white; font-weight: bold; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .hot { background: radial-gradient(circle at 30% 30%, #ff5f6d, #ff3131); }
        .mid { background: radial-gradient(circle at 30% 30%, #fbc531, #e1b12c); color: #2f3542; }
        .cold { background: radial-gradient(circle at 30% 30%, #448aff, #2979ff); }
        /* íƒ€ë¡œ */
        .tarot-wrap { background: #2c2c34; color: white; padding: 30px; border-radius: 20px; text-align: center; }
        .card-box { width: 150px; background: #3e3e4a; padding: 10px; border-radius: 10px; text-align: center; }
        .card-img { width: 100%; height: 240px; border-radius: 5px; border: 2px solid #555; object-fit: cover; }
        /* í™”íˆ¬ */
        .hwatu-wrap { text-align: center; }
        .slot-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 6px; margin-top: 20px; }
        .slot { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding-bottom: 8px; }
        .slot-header { background: var(--hwatu-red); color: white; padding: 5px; font-size: 12px; font-weight: bold; border-radius: 8px 8px 0 0; }
        .card-placeholder { width: 60px; height: 95px; margin: 5px auto; border: 1px dashed #ccc; position: relative; }
        .card { width: 100%; height: 100%; position: absolute; border: 2.5px solid #333; border-radius: 4px; background: white; font-weight: bold; font-size: 11px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card.back { background: var(--hwatu-red); color: transparent; border: 1px solid #800; }
        .card.mismatch { transform: rotate(90deg) scale(0.8); opacity: 0.5; }
        .log-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 30px; }
        .log-entry { text-align: left; padding: 10px; border-left: 4px solid var(--hwatu-red); background: #fffcfc; font-size: 13px; }
    </style>

    <py-config>
        packages = ["pandas", "openpyxl"]
    </py-config>
</head>
<body>

    <div class="header">
        <h1>ğŸ”® Multi-Analysis Dashboard</h1>
        <p>íŒŒì´ì¬ ë°ì´í„° ë¶„ì„ê³¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ìš´ì„¸ í”„ë¡œì íŠ¸ í†µí•©</p>
    </div>

    <div class="dashboard">
        <div class="app-card" onclick="openApp('lotto')">
            <span class="icon">ğŸš€</span>
            <h2>ë¡œë˜ í•«ë„˜ë²„ ë¶„ì„</h2>
            <p>lotto_prob.xlsx ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ<br>ìƒìœ„ ë¹ˆë„ìˆ˜ ë²ˆí˜¸ë¥¼ ì§‘ì¤‘ ì¡°í•©í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="app-card" onclick="openApp('tarot')">
            <span class="icon">ğŸ”®</span>
            <h2>78ì¥ íƒ€ë¡œ ë§ˆìŠ¤í„°</h2>
            <p>ì˜¤ëŠ˜ì˜ 3ì¥ ìš´ì„¸ì™€<br>íŠ¹ì • ì§ˆë¬¸ì— ëŒ€í•œ 1ì¥ ì¡°ì–¸ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>
        <div class="app-card" onclick="openApp('hwatu')">
            <span class="icon">ğŸ´</span>
            <h2>ì‹ ë…„ ì •í†µ í™”íˆ¬ì </h2>
            <p>12ë‹¬ì˜ ìš´ì„¸ë¥¼ í™”íˆ¬íŒ¨ë¥¼ í†µí•´ í’€ì´í•˜ëŠ”<br>ì „í†µ ë°©ì‹ì˜ ìš´ì„¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p>
        </div>
    </div>

    <div id="modal-overlay" onclick="closeApp()">
        <div class="modal-container" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modal-title" style="margin:0;">Project Name</h2>
                <button class="close-btn" onclick="closeApp()">ë‹«ê¸° (ESC)</button>
            </div>
            <div id="app-viewport" class="app-content">
                </div>
        </div>
    </div>

    <script>
        function openApp(appId) {
            const viewport = document.getElementById('app-viewport');
            const titles = { 'lotto': 'ë¡œë˜ í•«ë„˜ë²„ ì§‘ì¤‘ ë¶„ì„', 'tarot': '78ì¥ í’€ ë°í¬ íƒ€ë¡œ', 'hwatu': 'ì‹ ë…„ ì •í†µ í™”íˆ¬ì ' };
            
            document.getElementById('modal-title').innerText = titles[appId];
            viewport.innerHTML = document.getElementById('content-' + appId).innerHTML;
            document.getElementById('modal-overlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // í›„ì† ì´ˆê¸°í™”
            if(appId === 'tarot') initDeck();
            if(appId === 'hwatu') createUI();
        }

        function closeApp() {
            document.getElementById('modal-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('app-viewport').innerHTML = '';
        }

        window.onkeydown = (e) => { if(e.key === 'Escape') closeApp(); };
    </script>

    <div id="content-lotto" style="display:none">
        <div style="text-align:center;">
            <h1>ğŸ”¥ ì‹¤ì¸¡ ë°ì´í„° í•«ë„˜ë²„ ë¶„ì„</h1>
            <p>í˜„ì¬ <b>lotto_prob.xlsx</b> íŒŒì¼ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.</p>
            <button class="close-btn" style="background:#2ecc71; padding:15px 40px; font-size:18px;" py-click="auto_load_and_generate">ë°ì´í„° ë¶„ì„ ë° ë²ˆí˜¸ ìƒì„±</button>
            <div id="status" style="margin:20px; font-weight:bold; color:red;"></div>
            <div id="result"></div>
        </div>
    </div>

    <div id="content-tarot" style="display:none">
        <div class="tarot-wrap">
            <h2>ì˜¤ëŠ˜ì˜ ìš´ì„¸ (3ì¥)</h2>
            <button class="close-btn" style="background:#8e44ad" onclick="drawTarot()">ìš´ì„¸ ë½‘ê¸°</button>
            <div id="result-display" style="display:flex; justify-content:center; gap:20px; margin-top:25px;"></div>
            <hr style="margin:40px 0; opacity:0.1;">
            <h3>ê¶ê¸ˆí•œ ì  ì§ˆë¬¸í•˜ê¸°</h3>
            <input type="text" id="user-question" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." style="padding:12px; width:60%; border-radius:8px; border:none;">
            <button class="close-btn" style="background:#27ae60" onclick="askTarot()">ì¡°ì–¸ ì¹´ë“œ</button>
            <div id="one-card-result" style="display:flex; justify-content:center; margin-top:25px;"></div>
        </div>
    </div>

    <div id="content-hwatu" style="display:none">
        <div class="hwatu-wrap">
            <button onclick="initGame()" style="background:var(--hwatu-red); color:white; padding:15px 60px; border-radius:30px; border:none; font-weight:bold; cursor:pointer; font-size:18px;">ìš´ì„¸ ë³´ê¸° ì‹œì‘</button>
            <div id="hwatu-status" style="font-size:22px; margin:20px; font-weight:bold; height:30px;"></div>
            <div class="slot-grid" id="slotGrid"></div>
            <div id="logContent" class="log-grid"></div>
        </div>
    </div>

    <script>
        // --- íƒ€ë¡œ í•µì‹¬ ë¡œì§ ---
        let fullDeck = [];
        const primaryBase = "https://www.sacred-texts.com/tarot/pkt/img/";
        function initDeck() {
            const major = ["The Fool", "The Magician", "The High Priestess", "The Empress", "The Emperor", "The Hierophant", "The Lovers", "The Chariot", "Strength", "The Hermit", "Wheel of Fortune", "Justice", "The Hanged Man", "Death", "Temperance", "The Devil", "The Tower", "The Star", "The Moon", "The Sun", "Judgement", "The World"];
            const suits = [{n:"Wands",i:"wa"},{n:"Cups",i:"cu"},{n:"Swords",i:"sw"},{n:"Pentacles",i:"pe"}];
            const ranks = ["ac","02","03","04","05","06","07","08","09","10","pa","kn","qu","ki"];
            fullDeck = [];
            major.forEach((n,i)=>fullDeck.push({id:String(i).padStart(2,'0'), name:n, type:'major'}));
            suits.forEach(s=>ranks.forEach((r,ri)=>fullDeck.push({id:s.i+r, name:`${r} of ${s.n}`, type:'minor', suit:s.i.charAt(0)})));
        }
        function drawTarot() {
            let sel = []; let d = [...fullDeck];
            for(let i=0; i<3; i++) sel.push({card: d.splice(Math.floor(Math.random()*d.length),1)[0], dir: Math.random()>0.5?"ì •ë°©í–¥":"ì—­ë°©í–¥"});
            document.getElementById('result-display').innerHTML = sel.map(s=>`<div class="card-box"><img src="${primaryBase}${s.card.id}.html" class="card-img" style="${s.dir==='ì—­ë°©í–¥'?'transform:rotate(180deg)':''}"><p>${s.card.name}</p></div>`).join('').replace(/\.html/g, '.jpg');
        }
        function askTarot() {
            const q = document.getElementById('user-question').value;
            if(!q) return alert("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.");
            const c = fullDeck[Math.floor(Math.random()*fullDeck.length)];
            document.getElementById('one-card-result').innerHTML = `<div class="card-box"><img src="${primaryBase}${c.id}.jpg" class="card-img"></div>`;
        }

        // --- í™”íˆ¬ í•µì‹¬ ë¡œì§ ---
        const MONTH_NAMES = ["", "ì†¡í•™", "ë§¤ì¡°", "ë²šê½ƒ", "í‘ì‹¸ë¦¬", "ë‚œì´ˆ", "ëª¨ë€", "í™ì‹¸ë¦¬", "ê³µì‚°", "êµ­ì¤€", "ë‹¨í’", "ì˜¤ë™", "ë¹„"];
        const FORTUNE_TEXT = {1:"ê¸°ìœ ì†Œì‹",2:"ì—°ì• ìš´",3:"ì—¬í–‰",4:"ì¸ë‚´",5:"ê²½ì‚¬",6:"í™”ëª©",7:"íš¡ì¬",8:"ëª…ì˜ˆ",9:"ìˆ ìë¦¬",10:"ì…ì¡°ì‹¬",11:"ëˆë³µ",12:"ê·€ì¸"};
        let finishOrder = []; let isGameOver = false;

        function createUI() {
            const g = document.getElementById('slotGrid'); g.innerHTML = '';
            for(let m=1; m<=12; m++){
                let h = `<div class="slot" id="slot-${m}"><div class="slot-header">${m}ì›”</div>`;
                for(let r=0; r<4; r++) h += `<div class="card-placeholder" id="p-${m}-${r}"></div>`;
                g.innerHTML += h + `</div>`;
            }
        }
        async function initGame() {
            createUI(); finishOrder = []; isGameOver = false;
            document.getElementById('hwatu-status').innerText = "íŒ¨ë¥¼ ëŒë¦¬ëŠ” ì¤‘...";
            let deck = [];
            for(let m=1; m<=12; m++) for(let r=0; r<4; r++) deck.push({m, r, id:`c-${m}-${r}`, up:false});
            deck.sort(()=>Math.random()-0.5);
            for(let m=1; m<=12; m++) for(let r=0; r<4; r++) {
                const d = deck.pop(); d.currM = m; window[d.id] = d;
                document.getElementById(`p-${m}-${r}`).innerHTML = `<div id="${d.id}" class="card back">?</div>`;
            }
            await new Promise(r=>setTimeout(r, 600));
            moveCard(window[document.querySelector('#slot-12 .card.back').id]);
        }
        async function moveCard(d) {
            if(!d || isGameOver) return;
            d.up = true; const el = document.getElementById(d.id);
            el.classList.remove('back'); el.innerHTML = `<div>${d.m}ì›”</div>`;
            const target = document.getElementById(`p-${d.m}-${d.r}`);
            const bumped = target.querySelector('.card');
            const bData = bumped ? window[bumped.id] : null;
            target.appendChild(el);
            
            setTimeout(() => {
                if(document.getElementById(`slot-${d.m}`).querySelectorAll('.card:not(.back)').length === 4 && !finishOrder.includes(d.m)) {
                    finishOrder.push(d.m); updateHwatuLog();
                }
            }, 50);

            await new Promise(r=>setTimeout(r, 400));
            if(bData && !bData.up) moveCard(bData);
            else {
                const next = document.querySelector('#slot-12 .card.back');
                if(next) moveCard(window[next.id]); else revealAll();
            }
        }
        function revealAll() {
            isGameOver = true; document.querySelectorAll('.card.back').forEach(el => {
                const d = window[el.id]; el.classList.remove('back'); el.innerHTML = `<div>${d.m}ì›”</div>`;
                if(d.currM !== d.m) el.classList.add('mismatch');
            });
            document.getElementById('hwatu-status').innerText = "ìš´ì„¸ í™•ì¸ ì™„ë£Œ!";
        }
        function updateHwatuLog() {
            const log = document.getElementById('logContent'); log.innerHTML = '';
            finishOrder.forEach((m, i) => {
                log.innerHTML += `<div class="log-entry"><b>${i+1}ë“±: ${m}ì›” (${MONTH_NAMES[m]})</b><br>${FORTUNE_TEXT[m]}</div>`;
            });
        }
    </script>

    <script type="py">
        import pandas as pd
        import random
        import io
        from pyscript import document
        from js import fetch, Uint8Array

        async def auto_load_and_generate(event):
            status = document.querySelector("#status")
            result = document.querySelector("#result")
            status.innerHTML = "â³ ì—‘ì…€ ì‹¤ì¸¡ ë°ì´í„° ë¶„ì„ ì¤‘..."
            try:
                # ì‚¬ìš©ìë‹˜ì´ ê´€ë¦¬í•˜ì‹œëŠ” ì—‘ì…€ ë¡œë“œ
                response = await fetch(f"./lotto_prob.xlsx?t={random.random()}")
                array_buffer = await response.arrayBuffer()
                file_bytes = Uint8Array.new(array_buffer).to_bytes()
                with io.BytesIO(file_bytes) as f:
                    df = pd.read_excel(f, engine='openpyxl', sheet_name='í™•ë¥ ')
                
                hot_list = df.nsmallest(20, 'ì¶œí˜„ ìˆœìœ„')['ë²ˆí˜¸'].tolist()
                final_html = "<h3>âœ¨ í•«ë„˜ë²„ ê¸°ë°˜ ì¶”ì²œ ì¡°í•© âœ¨</h3>"
                
                for _ in range(5):
                    h_cnt = random.choice([4, 5])
                    h_pick = random.sample(hot_list, h_cnt)
                    pool = [n for n in range(1, 46) if n not in h_pick]
                    r_pick = random.sample(pool, 6 - h_cnt)
                    nums = sorted(h_pick + r_pick)
                    
                    balls = "".join([f'<span class="ball {"hot" if n in hot_list else "mid"}">{n}</span>' for n in nums])
                    final_html += f'<div class="ball-container">{balls}</div>'
                
                result.innerHTML = final_html
                status.innerHTML = "âœ… ë¶„ì„ ì™„ë£Œ!"
            except Exception as e:
                status.innerHTML = f"âŒ ì—‘ì…€ ë¡œë“œ ì‹¤íŒ¨: {str(e)}"
    </script>

</body>
</html>
