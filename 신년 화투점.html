<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>신년 정통 화투점</title>
    <style>
        :root { --h-red: #cc0000; --h-gold: #b8860b; --bg-main: #ffffff; }
        body { background: var(--bg-main); color: #333; margin: 0; padding: 10px; font-family: 'Malgun Gothic', sans-serif; text-align: center; }
        .slot-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 6px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; max-width: 1250px; margin: 0 auto; }
        .slot { display: flex; flex-direction: column; gap: 8px; background: #ffffff; border: 1px solid #e9ecef; border-radius: 4px; padding-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .slot-header { background: var(--h-red); color: #fff; padding: 6px 0; font-weight: bold; font-size: 13px; border-radius: 4px 4px 0 0; }
        .card-placeholder { width: 64px; height: 102px; margin: 0 auto; border: 1px dashed #ced4da; border-radius: 4px; position: relative; }
        .card { width: 100%; height: 100%; border: 2px solid #333; border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 11px; color: #000; background-color: #fff; position: absolute; transition: all 0.4s ease; z-index: 5; box-sizing: border-box; }
        .rank-광 { border: 2.5px solid #ffbb00; background: #fffdf0; } 
        .rank-열끗 { border: 2.5px solid #d4af37; }
        .rank-띠 { border: 2.5px solid #0055ff; }
        .rank-피 { border: 1.5px solid #888; }
        .card.back { background: var(--h-red); background-image: repeating-linear-gradient(45deg, #b30000, #b30000 3px, #cc0000 3px, #cc0000 6px); color: transparent; border: 1px solid #800; }
        .card.mismatch { transform: rotate(90deg) scale(0.85); border: 2px solid #adb5bd; opacity: 0.6; background: #f1f3f5; z-index: 1; }
        #logContent { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 1100px; margin: 30px auto; background: #ffffff; padding: 20px; border-radius: 12px; border: 1px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .log-entry { color: #495057; font-size: 14px; text-align: left; padding: 12px 15px; background: #f8f9fa; border-radius: 6px; border-left: 5px solid var(--h-red); line-height: 1.5; }
        .log-entry.first { border-left-color: gold; background: #fffdf0; grid-column: span 3; font-size: 16px; margin-bottom: 10px; }
        button { background: var(--h-red); color: #fff; border: none; padding: 14px 60px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 20px 0; border-radius: 30px; box-shadow: 0 4px 15px rgba(204, 0, 0, 0.3); }
    </style>
</head>
<body>
    <button onclick="initGame()">신년 운세 보기</button>
    <div id="status" style="margin-bottom:20px; color: #333; font-weight:bold; font-size: 22px; height: 30px;"></div>
    <div class="slot-grid" id="slotGrid"></div>
    <div id="logContent"></div>

<script>
const MONTH_NAMES = ["", "송학", "매조", "벚꽃", "흑싸리", "난초", "모란", "홍싸리", "공산", "국준", "단풍", "오동", "비"];
const FORTUNE_TEXT = {
    1: "기쁜 소식이나 반가운 손님이 찾아옵니다.", 2: "그리운 님을 만나거나 연애운이 따릅니다.", 
    3: "새로운 곳으로 여행을 가거나 나들이할 일이 생깁니다.", 4: "약간의 고생이 따를 수 있으나 참으면 복이 옵니다.", 
    5: "국수 먹을 일(경사)이 생기거나 좋은 인연을 맺습니다.", 6: "집안에 화목한 웃음꽃이 피고 기쁜 일이 생깁니다.", 
    7: "생각지도 못한 곳에서 횡재수나 재물이 들어옵니다.", 8: "밤하늘의 달처럼 명예가 높아지고 이름이 알려집니다.", 
    9: "사람들과 술잔을 나누며 즐거운 대인관계를 맺습니다.", 10: "사소한 걱정거리가 생길 수 있으니 입조심을 하세요.", 
    11: "큰 돈이 들어오거나 하는 일이 크게 번창합니다.", 12: "귀한 손님이 오거나 큰 변화가 찾아오는 운세입니다."
};

function getCardInfo(month, idx) {
    if (month === 11) { // 오동 특수 위계: 광, 쌍피, 피, 피
        if (idx === 0) return { type: '광', name: '똥광' };
        if (idx === 1) return { type: '피', name: '쌍피' };
        return { type: '피', name: '피' };
    }
    // 광 > 열 > 띠 > 쌍피 > 피 위계
    let kwang = (month===1)?'일광':(month===3)?'삼광':(month===8)?'팔광':(month===12)?'비광':null;
    let yeol = (month===2)?'매조열':(month===4)?'흑싸리열':(month===5)?'난초열':(month===6)?'모란열':(month===7)?'홍싸리열':(month===8)?'고도리':(month===9)?'국준열':(month===10)?'단풍열':(month===12)?'비열끗':null;
    let ribbon = [1,2,3].includes(month)?'홍단':[4,5,7].includes(month)?'초단':[6,9,10].includes(month)?'청단':(month===12)?'비띠':[8].includes(month)?'띠':null;
    let ssangpi = (month===9)?'국준쌍피':(month===12)?'쌍피':null;
    let cards = [];
    if (kwang) cards.push({type:'광', name: kwang});
    if (yeol) cards.push({type:'열끗', name: yeol});
    if (ribbon) cards.push({type:'띠', name: ribbon});
    if (ssangpi) cards.push({type:'피', name: ssangpi});
    while(cards.length < 4) cards.push({type:'피', name: '피'});
    return cards[idx];
}

let finishOrder = [];
let isGameOver = false;

function createUI() {
    const grid = document.getElementById('slotGrid');
    grid.innerHTML = '';
    for (let m = 1; m <= 12; m++) {
        let slotHtml = `<div class="slot" id="slot-${m}"><div class="slot-header">${m}월</div>`;
        for (let r = 0; r < 4; r++) slotHtml += `<div class="card-placeholder" id="p-${m}-${r}"></div>`;
        grid.innerHTML += slotHtml + `</div>`;
    }
}

async function initGame() {
    createUI(); finishOrder = []; isGameOver = false;
    document.getElementById('logContent').innerHTML = '';
    document.getElementById('status').innerText = "패를 돌리고 있습니다...";
    let deck = [];
    for (let m = 1; m <= 12; m++) {
        for (let r = 0; r < 4; r++) {
            let info = getCardInfo(m, r);
            deck.push({ m, r, ...info, up: false, id: `c-${m}-${r}` });
        }
    }
    deck.sort(() => Math.random() - 0.5);
    for (let m = 1; m <= 12; m++) {
        for (let r = 0; r < 4; r++) {
            const cardData = deck.pop();
            const placeholder = document.getElementById(`p-${m}-${r}`);
            placeholder.innerHTML = `<div id="${cardData.id}" class="card back">?</div>`;
            cardData.currM = m; window[cardData.id] = cardData;
        }
    }
    await new Promise(r => setTimeout(r, 600));
    await useDecemberChance();
}

async function moveCard(cardData) {
    if (isGameOver) return;
    const el = document.getElementById(cardData.id);
    cardData.up = true;
    el.classList.remove('back');
    el.classList.add(`rank-${cardData.type}`);
    el.innerHTML = `<div style="font-size:9px; color:#666;">${cardData.m}월</div><div>${cardData.name}</div>`;
    const targetPlaceholder = document.getElementById(`p-${cardData.m}-${cardData.r}`);
    const bumpedEl = targetPlaceholder.querySelector('.card');
    const bumpedData = bumpedEl ? window[bumpedEl.id] : null;
    targetPlaceholder.appendChild(el);

    setTimeout(() => {
        const parentSlot = document.getElementById(`slot-${cardData.m}`);
        if (parentSlot.querySelectorAll('.card:not(.back):not(.mismatch)').length === 4 && !finishOrder.includes(cardData.m)) {
            finishOrder.push(cardData.m);
            updateLog();
        }
    }, 20);

    await new Promise(r => setTimeout(r, 450));
    if (bumpedData && !bumpedData.up) await moveCard(bumpedData);
    else {
        const decBacks = document.querySelectorAll('#slot-12 .card.back');
        if (decBacks.length > 0) await moveCard(window[decBacks[0].id]);
        else await revealAllRemaining();
    }
}

async function useDecemberChance() {
    const decBacks = document.querySelectorAll('#slot-12 .card.back');
    if (decBacks.length > 0) await moveCard(window[decBacks[0].id]);
    else await revealAllRemaining();
}

async function revealAllRemaining() {
    if (isGameOver) return; isGameOver = true;
    const remainingBacks = Array.from(document.querySelectorAll('.card.back'));
    for (let el of remainingBacks) {
        const cardData = window[el.id];
        cardData.up = true; el.classList.remove('back'); el.classList.add(`rank-${cardData.type}`);
        el.innerHTML = `<div style="font-size:9px; color:#666;">${cardData.m}월</div><div>${cardData.name}</div>`;
        if (cardData.currM !== cardData.m) el.classList.add('mismatch');
        await new Promise(r => setTimeout(r, 50));
    }
    document.getElementById('status').innerText = "신년 운세 확인이 완료되었습니다.";
}

function updateLog() {
    const log = document.getElementById('logContent');
    log.innerHTML = '';
    finishOrder.forEach((month, index) => {
        const entry = document.createElement('div');
        entry.className = 'log-entry' + (index === 0 ? ' first' : '');
        let title = (index === 0) ? `<b>[올해의 총운] ${month}월 ${MONTH_NAMES[month]}</b>` : `<b>${index + 1}등: ${month}월</b>`;
        entry.innerHTML = `${title}<br>${FORTUNE_TEXT[month]}`;
        log.appendChild(entry);
    });
}
</script>
</body>
</html>